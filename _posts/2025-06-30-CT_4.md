---
layout: single
title:  "4.Probability of detection"
category: "Computed tomography"
tag: [Computed tomography, CT, X-ray, Probability, Detection, Statistics]
# header:
#   teaser: ../images/2025-06-27-CT_3/img.png
toc: true
toc_sticky: true
toc_label: CONTENTS
toc_icon: "fa-solid fa-seedling" # More icons: https://fontawesome.com/v6/search?ic=free
author_profile: false
sidebar:
    nav: "counts"
search: true # Change true to false if you don't want to have this article be searched 
redirect_from:
    - /Computed tomography/CT_4
use_math: true
---

**[Reference]** <br>
$\bullet$ Computed Tomography: Principles, Design, Artifacts, and Recent Advances <br>
$\bullet$ Computed Tomography: From Photon Statistics to Modern Cone-Beam CT
{: .notice--success}

# 0.Introduction
We will discuss the probability of detection (Mathematical modeling of photon-detection).
More specifically, we will focus on the probability that a photon, from the moment it is generated by the X-ray source, passes through an object, and is finally detected.

![image-20250701171250347](../images/2025-06-30-CT_4/image-20250701171250347.png)

As shown in the overview diagram above, which illustrates the entire CT scan and reconstruction workflow, this corresponds to the process indicated by the three orange circles in the first figure.

It is important to note that for this discussion, **we will assume the X-ray source is monoenergetic**, meaning it emits photons of a single energy level.
Consequently, the LAC, which was previously expressed as a function of both the spatial parameter, r and energy E, $\mu(r,E)$, now simplifies to a function dependent only on the spatial parameter, r:

<div class="math-box">
$$
\mu(r, E) \rightarrow \mu(r)
$$
</div>

# 1.Mathematical modeling for monochromatic X-ray

## 1-1) Probability for X-ray photon generation
{% include start-side-by-side.html
  image_src="../images/2025-06-30-CT_4/image-20250701191124217.png"
  image_alt=""
  image_width="30%"
%}
Let's mathematically model the generation of photons from an X-ray source. (Monoenergetic!)<br>
This corresponds to the process occurring in the area marked by the orange circle in the left figure.<br><br>
{% include end-side-by-side.html %}

<div class="math-box" markdown="1">
1. Let $N$ be the number of electrons striking the anode during the time interval [0, T], and let $p_1$ be the probability that a single electron successfully generates an X-ray photon.

2. Let the random variable $X$ be the number of successful X-ray photon generations from these $N$ electrons.

3. Under these conditions, the probability of generating exactly $n$ photons from $N$ electrons, $P(X = n)$, follows a binomial distribution:<br><center>$P(X = n) = \binom{N}{n} p_{1}^n (1 - p_1)^{N - n}$</center>

4. In a realistic scenario, the number of electrons $N$ is extremely large ($N \rightarrow \infty$) while the probability of success $p_1$ is very small ($p_1 \rightarrow 0$). <br>If their product, the expected value $E(X)=\lambda=N\cdot p_1=N_0$, remains constant, this binomial distribution can be approximated by a Poisson distribution:<br>
<center>$P(X = n) = \lim\limits_{N \to \infty, p_1 \to 0} \binom{N}{n} p_{1}^n (1 - p_{1})^{N - n} = \frac{e^{-N_0} N_0^n}{n!} $</center>
<br>
Here, $N_0$ is the expected average number of X-ray photons to be generated (a value often provided in reference data or by the manufacturer).
</div>

## 1-2) Probability for X-ray photon transmission
{% include start-side-by-side.html
  image_src="../images/2025-06-30-CT_4/image-20250701212408002.png"
  image_alt=""
  image_width="30%"
%}
Let's create a mathematical model for the probability of an X-ray photon passing through an object.<br><br>
{% include end-side-by-side.html %}

{% include start-box.html class="math-box" %}
1. Given that $n$ photons are generated at the source, our goal is to find the probability that $M$ of them will successfully transmit through the object. To do this, we will first derive the probability for a single photon and then extend it to $M$ photons.

2. As shown in the figure below, let's consider a single, continuous object as a series of many small, discrete objects $(r_1, r_2, \dots, r_k)$. The length of each small object is denoted by $\Delta r$. <img src="../images/2025-06-30-CT_4/image-20250702094644747.png" style="width: 80%; height: auto;">{: .align-center} For an infinitesimally small segment $\Delta r$, the probability that a single photon is absorbed as it travels from segment $j-1$ to $j$ is approximately $\mu_a(r_i)\Delta r$*. Therefore, the probability that the photon is not absorbed and successfully passes from segment $j-1$ to $j$ is approximately $1-\mu_a (r_i) \Delta r$.<br> <center>\begin{array}{l} p_{\text{absor}} = \mu_a(r_j)\Delta r \\ p_{\text{pass}}=1-\mu_a(r_j)\Delta r \end{array}</center>

3. Consequently, the probability that a photon passes through all $k$ segments without being absorbed is the product of the individual probabilities:<br> <center>$\text{Probability for a photon will transmit the object, p}_2 = \prod_{i=1}^{k} \left\{ 1 - \mu_a(\mathbf{r}_i) \Delta \mathbf{r} \right\}$</center>

4. Now, we can simplify this expression by making the object segments infinitesimally small and infinitely numerous ($k \rightarrow \infty, \Delta r \rightarrow 0$). <br> The probability $p_2$ that a photon transmits through the object becomes: <br> <center>\begin{split} p_2 &= \lim\limits_{k \to \infty, \Delta \mathbf{r} \to 0} \prod_{i=1}^{k} \left\{ 1 -\mu_a(\mathbf{r}_j) \Delta \mathbf{r} \right\} = \lim\limits_{k \to \infty, \Delta \mathbf{r} \to 0} e^{\left\{ \ln \left( \prod_{i=1}^{k} \left\{ 1 - \mu_a(\mathbf{r}_j) \Delta \mathbf{r} \right\} \right) \right\}} \\ \\
&= \lim\limits_{k \to \infty, \Delta \mathbf{r} \to 0} e^{\left\{ \sum\limits_{i=1}^{k} \ln \left( 1 - \mu_a(\mathbf{r}_j) \Delta \mathbf{r} \right) \right\}} \\ \\ &\bigg\downarrow \small{\left(\lim\limits_{x \to 0}\frac{\ln(1+x)}{x} = 1 \rightarrow \lim\limits_{x \to 0} \ln(1+x) = x \right) }\\ \\
& = \lim\limits_{k \to \infty, \Delta \mathbf{r} \to 0} e^{\left\{ \sum_{i=1}^{k} \left( -\mu_a(\mathbf{r}_j) \Delta \mathbf{r} \right) \right\}} = e^{\left\{ \int -\mu_a(\mathbf{r}) \, dr \right\}}\end{split}</center> This equation is the **Beer-Lambert law**, describing the intensity attenuation of a radiation beam traversing a macroscopically homogeneous medium.

5. Then, let's consider the number of photons that are pass the object. Let $Y$ be the random variable for the number of transmitted photons, given that $X=n$ photons were incident on the object. Since each of the $n$ photons has an independent transmission probability of $p_2$, the number of successfully transmitted photons $Y$ follows a binomial distribution, conditioned on $X=n$:<br><center>$$\small{P(Y=M|X=n)=\binom{n}{M}p_2^M (1-p_2)^{n-M}, \quad \text{for } M \le n}$$</center>

 {% include start-box.html class="math-box-inner" %}
 *Why $p_{\text{absor}} \approx \mu_a(r_j)\Delta r$?
 1. We assume that when an X-ray photon travels through a material, its probability of interacting (being absorbed or scattered) within an infinitesimally small distance $dx$ is proportional to that length. We define this proportionality constant as the LAC, $\mu_a(x)$. <br><center>$P_{(\text{interaction in infinitesimal length $dx$})}=\mu_a(x) dx$</center><center>$\small{\text{(Assume that the probabilities of interaction in any two non-overlapping intervals are independent.)}}$</center>

 2. Let $P(x)$ be the probability that a photon reaches position $x$ without interacting. Then, the probability of surviving up to position $x+dx$, denoted as $P(x+dx)$, can be seen as two consecutive events:<br><center>$$\small{\begin{array}{l}1)\text{Surviving up to position } x \text{(with probability: $P(x)$)} \\ 2)\text{Then surviving the subsequent small interval } [x+dx] \text{ with probability: $1-\mu_a(x)dx$} \\ \\ \rightarrow P(x+dx) = P(x)\cdot (1-\mu_a(x)dx) \rightarrow P(x+dx) - P(x) = -P(x) \mu_a(x) dx \\ \rightarrow \frac{P(x+dx) - P(x)}{dx} = -P(x) \mu_a(x) \\ \xrightarrow[]{dx \to 0} \frac{dP(x)}{dx} = - \mu_a(x) P(x) \\ \end{array}}$$</center>

 3. This differential equation can be solved using the method of separation of variables.<br><center>$$\small{\frac{1}{P(x)} dP(x) = - \mu_a(x) dx}$$</center>Integrate both sides (from the starting point 0 to a distance L):<center>$$\small{\begin{align} \int_{P(0)}^{P(L)} \frac{1}{P} dP &= \int_0^L -\mu_a(x) dx \\ [\ln P]_ {P(0)}^{P(L)} &= -\int_0^L \mu_a(x) dx \\ \ln P(L) - \ln P(0) &= -\int_0^L \mu_a(x) dx \end{align}}$$</center>Before the photon enters the material (at $x=0$), its survival probability is 1. $\rightarrow P(0)=1$
 Thus, the survival probability $P(L)$ after traveling a distance L is:<br><center>$$\small{\begin{align}\ln P(L) &= -\int_0^L \mu_a(x) dx \\ P(L) &= e^{-\int_0^L \mu_a(x) dx} \end{align}}$$</center>If the material is homogeneous (i.e, $\mu_a(x)$ is a constant, $\mu_a$) and the distance is $\Delta r$, this equation simplifies to: <center>$$\small{\begin{align} P_{\text{pass}}(\Delta r) &= e^{-\mu_a \Delta r} \\ P_{\text{absor}}(\Delta r) &= 1 - e^{-\mu_a \Delta r} \end{align}}$$</center>When $\Delta r$ becomes infinitesimal, this equation becomes ($$ x \approx 0 \to e^{-x} \approx 1 -x $$):<be><center>$$\small{\begin{align} P_{\text{pass}}(\Delta r) &\approx 1 - \mu_a \Delta r \\ P_{\text{absor}}(\Delta r) &\approx \mu_a \Delta r \end{align}}$$</center> 
  {% include end-box.html %}
 {% include end-box.html %}

## 1-3) Probability for X-ray photon detection
{% include start-side-by-side.html
  image_src="../images/2025-06-30-CT_4/image-20250702143825061.png"
  image_alt=""
  image_width="30%"
%}
Now, let's model what happens when the photons reach the detector.<br><br>
{% include end-side-by-side.html %}

{% include start-box.html class="math-box" %}
1. The photons that have successfully passed through the object are the ones that are incident on the detector. Therefore, the random variable for the number of photons arriving at the detector is the same as the random variable for the number of transmitted photons, which we have already defined as $Y$. <br>(We assume no photons are lost between the object and the detector.)

2. Each of these $M$ incident photons is then registered by the detector with a certain probability, $q$, known as the detector's quantum efficiency. This efficiency accounts for the fact that not every photon hitting the detector will produce a measurable electronic signal.

3. Let $Z$ be the random variable for the number of photons finally registered by the detector. Given that $Y=M$ photons arrive at the detector, the detection of each photon is an independent Bernoulli trial with success probability $q$. Thus, the number of registered photons, $Z$, follows a binomial distribution, conditioned on the number of arriving photons, $M$:<br><center>$$\small{P(Z=m|Y=M)=\binom{M}{m}q^m (1-q)^{M-m}, \quad \text{for $m \le M$}}$$</center>

4. To find the unconditional probability distribution of the detected photons, $P(Z=m)$, we need to consider the entire chain of events. A remarkable property of cascaded Poisson and binomial processes is that the final distribution is also a Poisson distribution. The expected number of detected photons, $E[Z]$, can be found using the law of total expectation:<br><center>$$\small{E[Z]=E_Y [E_Z [Z|Y]] = E_Y[Y \cdot q] = q \cdot E_Y[Y]}$$</center>Similarly, <br><center>$$\small{E[Y] = E_X[E_Y [Y|X]] = E_X[X \cdot p_2]=p_2 \cdot E_X[X] = p_2 \cdot N_0}$$</center>Combining these, the expected number of detected photons is:<br><center>$$\small{\lambda_{det} = E[Z]=N_0 \cdot p_2 \cdot q}$$</center>Since the initial process is Poisson and it undergoes two independent binomial thinnings (transmission and detection), the resulting random variable $Z$ also follows a Poisson distribution with the new mean $\lambda_{det}$. Therefore, the final probability of detecting exactly $m$ photons is given by:<br><center>$$\small{P(Z=m)=\frac{e^{-N_0 p_2 q}(N_0 p_2 q)^m}{m!}, \quad \text{where  } \begin{array}{l} N_0: \text{the mean of incident photons} \\ p_2 = e^{-\int \mu_a(r)dr} \text{: the transmission probability} \\ q: \text{the detector quantum efficiency} \end{array}}$$</center>
{% include end-box.html %}





